@{
    ViewData["Title"] = "Login";
}

<div class="container py-5" style="max-width: 480px;">
    <h2 class="mb-4">Login</h2>

    <div class="mb-3">
        <label class="form-label">Username</label>
        <input id="loginUsername" type="text" class="form-control" placeholder="e.g. System Admin" />
    </div>

    <div class="d-flex gap-2">
        <button id="loginBtn" class="btn btn-primary">Login</button>
    </div>
</div>

@section Scripts {
    <script>
        const apiBase = "https://localhost:7281/";

        async function login(username) {
          const res = await fetch(apiBase + "api/login", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify({ username })
          });
          if (!res.ok) throw new Error(await res.text());
          const user = await res.json();
          localStorage.setItem("cp_user", JSON.stringify(user));
        }

        document.getElementById("loginBtn")?.addEventListener("click", async () => {
          const u = document.getElementById("loginUsername").value.trim();
          if (!u) { alert("Username required"); return; }  

          try {
            await login(u);
            window.location.href = "/Home/Index";
          } catch (e) {
            alert("Usuario no válido o inactivo");
          }
        });
    </script>
}
